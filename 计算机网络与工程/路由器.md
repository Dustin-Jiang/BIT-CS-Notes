路由器是网络层的核心设备，具有多个输入输出端口。

### 核心功能 #重点

1. **路由选择**：运行路由算法，建立路由表。
2. **分组转发**：
    - **输入端口**：物理层接收 $\rightarrow$ 链路层拆封 $\rightarrow$ 网络层查找转发表 $\rightarrow$ 排队。
    - **交换结构**：将分组从输入端口移动到输出端口。
    - **输出端口**：缓存管理 $\rightarrow$ 排队调度 $\rightarrow$ 链路层封装 $\rightarrow$ 物理层发送。

### 分组转发算法 #重点

1. 从数据报首部提取目的主机 IP 地址 $D$，得出目的网络地址 $N$。
2. 若 $N$ 与此路由器直接相连，则进行 **直接交付**。
3. 若路由表中有目的地址为 $D$ 的 **特定主机路由**，则转发给指定下一跳。
4. 若路由表中有到达网络 $N$ 的路由，则转发给指定下一跳。
5. 若路由表中有 **默认路由**，则转发给默认路由器。
6. 否则，报告转发分组出错。

### 交换结构类型

- **经内存交换**：早期，CPU 瓶颈。
- **经总线交换**：总线竞争。
- **经互联网络交换**：如 Banyan 网络，支持并行转发。

### 排队与丢包

- **输出排队**：交换速率快于输出链路速率。
- **输入排队**：线头 (HOL) 阻塞。
- **丢包**：当缓存溢出时，后续到达的分组会被丢弃。
