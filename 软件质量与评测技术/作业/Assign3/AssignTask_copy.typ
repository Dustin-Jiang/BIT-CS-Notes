== 功能需求

在 OpenGauss 数据库中, 设计实现 "电脑诊所管理系统", 要求能实现以下功能:

=== 普通用户功能
- 用户注册与登录
  - 支持用户名密码认证
  - 记录真实姓名、电话号码、所属校区、学院等个人信息
- 预约管理
  - 创建维修预约（支持通过微信端或现场登记）
  - 填写电脑问题描述、型号、密码等信息
  - 选择校区和预约日期
  - 查看自己的预约工单列表（包括进行中和已完成的工单）
  - 查看工单详细状态和维修人员反馈
  - 取消未处理的预约
- 信息查看
  - 查看各校区服务时间和剩余预约名额
  - 查看公告信息（包括普通公告、置顶公告、免责声明）

=== 工作人员功能
- 具备普通用户的所有权限
- 值班时间管理
  - 设置每周的值班时间（周一至周日）
- 工单处理
  - 查看分配给自己的工单
  - 修改工单状态（预约已确认、正在处理、已解决问题、建议返厂、扔给明天、预约已驳回等）
  - 填写问题描述、处理方法
  - 拒绝预约时需填写拒绝理由
  - 记录到达时间和完成时间
  - 标记电脑是否已取走

=== 管理员功能
- 用户管理
  - 查看和管理所有用户信息
  - 设置工作人员权限
  - 查看特定校区或当日值班的工作人员
- 工单管理
  - 查看所有工单或按校区筛选
  - 现场登记新工单（为未注册用户创建工单）
  - 批量取消某日期某校区的所有未完成工单
  - 通知用户取电脑
- 服务时间管理
  - 创建、修改、删除服务时间
  - 设置每个服务时段的名称、日期、校区、时间范围、可服务人数
  - 实时查看各时段的预约数量、完成数量、进行中数量
  - 约束：已有工单的服务时间不可修改或删除
- 公告管理
  - 发布、编辑、删除公告
  - 设置公告类型（普通公告、置顶公告、免责声明）
  - 设置公告标题、内容、简介、优先级、失效时间
- 校区管理
  - 管理校区信息（名称、地址）

=== 业务规则
- 用户同一时间只能有一个进行中的工单
- 服务时间达到容量上限后不再接受新预约
- 不能预约过去的日期或停业日期
- 工单状态包括：上单未解决、预约待确认、预约已确认、预约已驳回、登记待受理、正在处理、已解决问题、建议返厂、扔给明天、未到诊所
- 当天服务结束后，微信端用户无法看到当天的服务时间
- 公告按优先级和创建时间排序，过期公告自动隐藏

== 数据实体设计

根据代码实现分析, 系统包含以下核心数据实体:

=== 1. 用户实体 (ClinicUser)

继承自 Django 的 AbstractUser，包含以下字段：

基本信息：
- username: 用户名（唯一）
- realname: 真实姓名
- phone_num: 电话号码
- campus: 所属校区（外键）
- school: 学院
- is_staff: 是否为工作人员

值班信息（仅工作人员）：
- work_mon ~ work_sun: 周一至周日值班标记

功能说明：
- 支持普通用户和工作人员两种角色
- 工作人员可设置每周值班时间
- 关联校区信息，便于按校区管理

=== 2. 工单实体 (Record)

记录维修预约的完整信息：

基本信息：
- user: 关联用户（外键，可为空以支持现场登记）
- worker: 关联维修人员（外键）
- realname: 真实姓名
- phone_num: 电话号码
- campus: 校区（外键）

时间信息：
- appointment_time: 预约日期
- arrive_time: 到达时间
- deal_time: 完成时间

问题描述：
- description: 用户自述问题
- worker_description: 工作人员描述
- model: 电脑型号
- password: 电脑密码

处理信息：
- status: 工单状态（0-9，共10种状态）
- method: 处理方法
- reject_reason: 拒绝理由
- is_taken: 是否已取走

工单状态定义：
- 0: 上单未解决
- 1: 预约待确认
- 2: 预约已确认
- 3: 预约已驳回
- 4: 登记待受理
- 5: 正在处理
- 6: 已解决问题
- 7: 建议返厂
- 8: 扔给明天
- 9: 未到诊所

=== 3. 服务时间实体 (Date)

管理各校区的服务时间和容量：

- title: 服务名称（如"正常服务"）
- date: 服务日期
- campus: 校区（外键）
- startTime: 服务开始时间
- endTime: 服务结束时间
- capacity: 可服务人数

唯一约束：
- 每个校区每天只能有一个服务时间

计算字段：
- count(): 当前预约数量（排除已驳回）
- finish(): 已完成数量（状态6、7、8）
- working(): 正在服务数量（状态5）

=== 4. 公告实体 (Announcement)

管理系统公告信息：

- title: 标题
- content: 内容
- brief: 内容概括
- tag: 类型（AN普通公告、TOS免责声明、TA置顶公告）
- priority: 显示优先级
- createdTime: 创建时间
- lastEditedTime: 最后编辑时间
- expireDate: 失效时间

排序规则：
- 按优先级和创建时间倒序排列

=== 5. 校区实体 (Campus)

管理校区基本信息：

- name: 校区名称（唯一）
- address: 诊所地址

== 系统架构说明

- 后端框架：Django + Django REST Framework
- 认证方式：基于 Session 的认证 + API Key 认证（微信端）
- API 设计：RESTful API，支持完整的 CRUD 操作
- 权限控制：基于角色的权限管理（普通用户、工作人员、管理员）
- 数据库：支持 PostgreSQL/OpenGauss
- 部署方式：Docker 容器化部署
